from numpy import array

"""
===============================================================================
 Archivo:       Butcher.py
 Creado:        20/11/2025
 Descripción:    
 
 Tablas de Butcher para métodos de Runge-Kutta embebidos de alto orden.

 Dependencias:
    - NumPy
    
 Notas:
===============================================================================
"""

def Butcher_tableau(method_name):
    """    
    c: array of constants
    a: Butcher's array
    b: array used for solution estimation
    bs: array used for error estimation    
    q: highest order of the scheme
    p: lowest order of the scheme
    s: stages
    """

    if method_name in ["RK4(5)", "RKF45"]:        
        c = array([0.0, 1/4, 3/8, 12/13, 1.0, 1/2])
        a = array([ [0.0, 0.0, 0.0, 0.0, 0.0, 0.0], 
                   [1/4, 0.0, 0.0, 0.0, 0.0, 0.0], 
                   [3/32, 9/32, 0.0, 0.0, 0.0, 0.0], 
                   [1932/2197, -7200/2197, 7296/2197, 0.0, 0.0, 0.0], 
                   [439/216, -8.0, 3680/513, -845/4104, 0.0, 0.0], 
                   [-8/27, 2.0, -3544/2565, 1859/4104, -11/40, 0.0] ])
        b = array([25/216, 0.0, 1408/2565, 2197/4104, -1/5, 0.0])
        bs = array([16/135, 0.0, 6656/12825, 28561/56430, -9/50, 2/55])
        q = 5
        p = 4
        s = 6
    elif method_name in ["RK5(4)7M", "DOPRI5"]:        
        c = array([0.0, 0.2, 0.3, 0.8, 8/9, 1.0, 1.0])        
        a = array([ [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], 
             [0.2, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], 
             [3/40, 9/40, 0.0, 0.0, 0.0, 0.0, 0.0], 
             [44/45, -56/15, 32/9, 0.0, 0.0, 0.0, 0.0], 
             [19372/6561, -25360/2187, 64448/6561, -212/729, 0.0, 0.0, 0.0], 
             [9017/3168, -355/33, 46732/5247, 49/176, -5103/18656, 0.0, 0.0], 
             [35/384, 0.0, 500/1113, 125/192, -2187/6784, 11/84, 0.0] ])
        b = array([35/384, 0.0, 500/1113, 125/192, -2187/6784, 11/84, 0.0])
        bs = array([5179/57600, 0.0, 7571/16695, 393/640, -92097/339200, 187/2100, 1/40])
        q = 5
        p = 4
        s = 7       
    elif method_name in ["RK5(6)", "RKF56"]:
        c = array([0., 1./6, 4./15, 2./3, 4./5, 1., 0., 1.])
        a = array([
            [0., 0., 0., 0., 0., 0., 0., 0.],
            [1./6, 0., 0., 0., 0., 0., 0., 0.],
            [4./75, 16./75, 0., 0., 0., 0., 0., 0.],
            [5./6, -8./3, 5./2, 0., 0., 0., 0., 0.],
            [-8./5, 144./25, -4., 16./25, 0., 0., 0., 0.],
            [361./320, -18./5, 407./128, -11./80, 55./128, 0., 0., 0.],
            [-11./640, 0., 11./256, -11./160, 11./256, 0., 0., 0.],
            [93./640, -18./5, 803./256, -11./160, 99./256, 0., 1., 0.] ])
        b = array([31./384, 0., 1125./2816, 9./32, 125./768, 5./66, 0., 0.])
        bs = array([7./1408, 0., 1125./2816, 9./32, 125./768, 0, 5./66, 5./66])          
        q = 6
        p = 5
        s = 8
    elif method_name in ["RK6(5)8M", "DOPRI6"]:        
        c = array([0, 1/10, 2/9, 3/7, 3/5, 4/5, 1, 1])
        a = array([
            [0, 0, 0, 0, 0, 0, 0, 0],
            [1/10, 0, 0, 0, 0, 0, 0, 0],
            [-2/81, 20/81, 0, 0, 0, 0, 0, 0],
            [-615/1372, -270/343, 1053/1372, 0, 0, 0, 0, 0],
            [3243/5500, -54/55, 50949/71500, 4998/17875, 0, 0, 0, 0],
            [-26492/37125, 72/55, 2808/23375, -24206/37125, 338/459, 0, 0, 0],
            [5561/2376, -35/11, -24117/31603, 899983/200772, -5225/1836, 3925/4056, 0, 0],
            [465467/266112, -2945/1232, -5610201/14158144, 10513573/3212352, -424325/205632, 376225/454272, 0, 0]])
        b = array([61/864, 0, 98415/321776, 16807/146016, 1375/7344, 1375/5408, -37/1120, 1/10])
        bs = array([821/10800, 0, 19683/71825, 175273/912600, 395/3672, 785/2704, 3/50, 0])
        q = 6
        p = 5
        s = 8
    elif method_name in ["RK6(7)", "RKF67"]:
        c = array([0., 2./33, 4./33, 2./11, 1./2, 2./3, 6./7, 1., 0., 1.])
        a = array([
            [0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
            [2./33, 0., 0., 0., 0., 0., 0., 0., 0., 0.],
            [0., 4./33, 0., 0., 0., 0., 0., 0., 0., 0.],
            [1./22, 0., 3./22, 0., 0., 0., 0., 0., 0., 0.],
            [43./64, 0., -165./64, 77./32, 0., 0., 0., 0., 0., 0.],
            [-2383./486, 0., 1067./54, -26312./1701, 2176./1701, 0., 0., 0., 0., 0.],
            [10077./4802, 0., -5643./686, 116259./16807, -6240./16807, 1053./2401, 0., 0., 0., 0.],
            [-733./176, 0., 141./8, -335763./23296, 216./77, -4617./2816, 7203./9152, 0., 0., 0.],
            [15./352, 0., 0., -5445./46592, 18./77, -1215./5632, 1029./18304, 0., 0., 0.],
            [-1833./352, 0., 141./8, -51237./3584, 18./7, -729./512, 1029./1408, 0., 1., 0.]])
        b = array([77./1440, 0., 0., 1771561./6289920, 32./105, 243./2560, 16807./74480, 11./270, 0., 0.])
        bs = array([11./864, 0., 0., 1771561./6289920, 32./105, 243./2560, 16807./74480, 0., 11./270, 11./270])         
        q = 7
        p = 6
        s = 10
    elif method_name in ["RK7(8)", "RKF78"]:
        c = array([0., 2./27, 1./9, 1./6, 5./12, 1./2, 5./6, 1./6, 2./3 , 1./3,   1., 0., 1.])
        a = array([
            [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0], 
            [2./27, 0., 0., 0., 0., 0., 0.,  0., 0., 0., 0., 0., 0],
            [1./36 , 1./12, 0., 0., 0., 0., 0.,  0.,0., 0., 0., 0., 0], 
            [1./24 , 0., 1./8 , 0., 0., 0., 0., 0., 0., 0., 0., 0., 0], 
            [5./12, 0., -25./16, 25./16., 0., 0., 0., 0., 0., 0., 0., 0., 0],
            [1./20, 0., 0., 1./4, 1./5, 0., 0.,0., 0., 0., 0., 0., 0], 
            [-25./108, 0., 0., 125./108, -65./27, 125./54, 0., 0., 0., 0., 0., 0., 0], 
            [31./300, 0., 0., 0., 61./225, -2./9, 13./900, 0., 0., 0., 0., 0., 0], 
            [2., 0., 0., -53./6, 704./45, -107./9, 67./90, 3., 0., 0., 0., 0., 0], 
            [-91./108, 0., 0., 23./108, -976./135, 311./54, -19./60, 17./6, -1./12, 0., 0., 0., 0], 
            [2383./4100, 0., 0., -341./164, 4496./1025, -301./82, 2133./4100, 45./82, 45./164, 18./41, 0., 0., 0], 
            [3./205, 0., 0., 0., 0., -6./41, -3./205, -3./41, 3./41, 6./41, 0., 0., 0],
            [-1777./4100, 0., 0., -341./164, 4496./1025, -289./82, 2193./4100, 51./82, 33./164, 12./41, 0.,  1., 0] ])        
        b = array([41./840, 0., 0., 0., 0., 34./105, 9./35, 9./35, 9./280, 9./280, 41./840, 0., 0.])
        bs= array([ 0., 0., 0., 0., 0., 34./105, 9./35, 9./35, 9./280, 9./280, 0., 41./840, 41./840])
        q = 8
        p = 7
        s = 13
    elif method_name in ["RK8(7)13M", "DOPRI8"]:        
        c = array([0, 1/18, 1/12, 1/8, 5/16, 3/8, 59/400, 93/200, 5490023248/9719169821, 13/20, 1201146811/1299019798, 1, 1])                
        a = array([
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [1/18, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [1/48, 1/16, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [1/32, 0, 3/32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [5/16, 0, -75/64, 75/64, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [3/80, 0, 0, 3/16, 3/20, 0, 0, 0, 0, 0, 0, 0, 0],
        [29443841/614563906, 0, 0, 77736538/692538347, -28693883/1125000000, 23124283/1800000000, 0, 0, 0, 0, 0, 0, 0],
        [16016141/946692911, 0, 0, 61564180/158732637, 22789713/633445777, 545815736/2771057229, -180193667/1043307555, 0, 0, 0, 0, 0, 0],
        [39632708/573591083, 0, 0, -433636366/683701615, -421739975/2616292301, 100302831/723423059, 790204164/839813087, 800635310/3783071287, 0, 0, 0, 0, 0],
        [246121993/1340847787, 0, 0, -37695042795/15268766246, -309121744/1061227803, -12992083/490766935, 6005943493/2108947869, 393006217/1396673457, 123872331/1001029789, 0, 0, 0, 0],
        [-1028468189/846180014, 0, 0, 8478235783/508512852, 1311729495/1432422823, -10304129995/1701304382, -48777925059/3047939560, 15336726248/1032824649, -45442868181/3398467696, 3065993473/597172653, 0, 0, 0],
        [185892177/718116043, 0, 0, -3185094517/667107341, -427755414/1098053517, -703635378/230739211, 5731566787/1027545527, 5232866602/850066563, -4093664535/808688257, 3962137247/1805957418, 65686358/487910083, 0, 0],
        [403863854/491063109, 0, 0, -5068492393/434740067, -411421997/543043805, 652783627/914296604, 11173962825/925320556, -13158990841/6184727034, 3936647629/1978049680, -160528059/685178525, 248638103/1413531060, 0, 0] ])
        b = array([14005451/335480064, 0, 0, 0, 0, -59238493/1068277825, 181606767/758867731, 561292985/797845732, -1041891430/1371343529, 760417239/1151165299, 118820643/751138087, -528747749/2220607170, 1/4])
        bs = array([ 13451932/455176623, 0, 0, 0, 0, -808719846/976000145, 1757004468/5645159321, 656045339/265891186, -3867574721/1518517206,  465885868/322736535, 53011238/667516719, 2/45, 0])
        q = 8
        p = 7
        s = 13    
    elif method_name == "Cash-Karp":        
        c = array([0.0, 1/5, 3/10, 3/5, 1.0, 7/8])
        a = array([[0.0, 0.0, 0.0, 0.0, 0.0, 0.0], 
                   [1/5, 0.0, 0.0, 0.0, 0.0, 0.0], 
                   [3/40, 9/40, 0.0, 0.0, 0.0, 0.0], 
                   [3/10, -9/10, 6/5, 0.0, 0.0, 0.0], 
                   [-11/54, 5/2, -70/27, 35/27, 0.0, 0.0], 
                   [1631/55296, 175/512, 575/13824, 44275/110592, 253/4096, 0.0] ])
        b = array([37/378, 0.0, 250/621, 125/594, 0.0, 512/1771])
        bs = array([2825/27648, 0.0, 18575/48384, 13525/55296, 277/14336, 1/4])
        q = 5
        p = 4
        s = 6
    else:
        print("ERROR: Invalid embedded RK method selected")
        return

    return c, a, b, bs, q, p, s